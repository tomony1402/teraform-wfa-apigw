# modern-core-eks-iac / teraform-wfa-apigw

AWS WAFを利用したAPI Gatewayの保護、およびTerraform管理への移行用リポジトリです。

## 1. プロジェクトの背景と目的
本プロジェクトは、背後にある**「リダイレクトサーバー」**をインターネットの脅威から保護しつつ、安全に外部へ公開することを目的としています。

サーバーを直接公開するのではなく、**API Gatewayを「窓口（インターフェース）」**として設置し、その門番として **AWS WAF** を配備することで、特定の許可された利用者のみがアクセスできるセキュアなエンドポイントを構築しました。

## 2. 構築内容

### ① API Gateway (`kensho-api`)
- **役割**: リダイレクトサーバーへの **「ゲートウェイ（門）」** および **「インターフェース（接点）」** の提供。
- **設定**: GETメソッドを実装し、リダイレクト処理を中継する窓口として構成。
- **エンドポイント**: 外部からアクセスするための具体的な接続先URLを発行。

### ② AWS WAF (`kensho-waf`)
- **役割**: 窓口に立つ **「セキュリティガード（門番）」**。
- **設定**: 許可したIPアドレス以外からのリクエストをすべて遮断。

### ③ カスタムレスポンス設定
ブロック時の挙動をカスタマイズし、隠蔽性を高めています。
- **レスポンス**: `Not Found 403`
- **意図**: 標準的なエラー画面を隠し、独自の応答を返すことで、正常にブロック（防御）できていることを管理者が一目で判別できるようにしました。

## 3. 用語の定義
本プロジェクトでは、技術的な概念を以下の「役割」と「感覚」で定義しています。

| 用語 | 本プロジェクトにおける定義・感覚 |
| :--- | :--- |
| **AWS WAF** | **「セキュリティガード（門番）」**。許可リスト（IP Set）にない通信を、玄関先で追い返す（Blockする）役割。 |
| **API Gateway** | システム全体の **「入り口（門）」** を管理するサービス。 |
| **インターフェース** | ユーザーがシステムとやり取りするための **「接続ルール」**。 |
| **エンドポイント** | ユーザーが実際にアクセスする **「具体的なURL（窓口）」**。 |
| **GETメソッド** | サーバーに対して **「この情報をちょうだい！」とリクエスト（要求）** するための通信方式。 |
| **リダイレクトサーバー** | 今回の構成で最終的に守りたい **「本尊（バックエンド）」**。 |

## 4. 今後の予定
- [ ] 手動設定した内容のTerraform化（`main.tf`への書き起こし）
- [ ] HCP Terraform を利用したStateのクラウド管理
